## CNP-building-blocks.db (source data and R scripts)

the repository includes source data and R scripts for constructing the database on molecular (i.e. macromolecules and their building blocks; e.g. total proteins and amino acids) and elemental (i.e. carbon, nitrogen and phosphorus) composition of 954 food items; such outputs are integrated by the file showing elemental composition of 13 large food categories (e.g. vegetables, fruits, grains, seeds, meat and fish/seafood). Also the file showing detailed report of all modifications made while executing the scripts is produced and used for technical validation. The project is based on four steps

### step 1
original and incomplete datasets are combined for complete summary of the content of macronutrients and simple molecules (e.g. proteins with amino acids) in 954 food items
- input: (i) **starting_file.xlsx** (initial, empty file with header labels for ID and name of food items; it represents the starting point for assembling all novel databases); (ii) **macronutrient_details.xlsx** (with multiple sheets regarding various aspects - e.g. sugar, lipid and protein contents in food items; relative amounts of carbon and nitrogen in amino acids; and phosphorus concentration in food)
- R scripts: (i) **add_data_original_db_function.R** (function that adds details on macronutrients and molecular composition of food items in a dataset); (ii) **add_data_original_db.R** - script that calls the function add_data_original_db_function.R to integrate the incomplete BEDCA dataset (that is composed of data on the contents of sugars, lipids, proteins, starch, fibers, fatty acids and phosphorus) with the concentrations of simple molecules (i.e. oligosaccharides and amino acids)
- output: **merged_db_original.xlsx** - such file includes the complete description of 954 food items in terms of macromolecules (i.e. total sugars, lipids and proteins) and their constitutive molecules (e.g. fatty acids: FA12_0 = C12:0, FA14_0 = C14:0 and FA16_0 = C16:0) but still presents some issues (i.e. NA values and inconsistencies when comparing the total amounts of macromolecules vs. the sum of their constitutive building blocks)

### step 2
management of data in merged_db_original.xlsx - first, NA values are classified as either zeros or proper missing values; second, for each food item a comparison between the total macronutrient content and the sum of its constitutive molecules is carried out. The
operations described in this step correspond to white boxes in Figure 1 of Romeo et al. (to be submitted to Scientific Data). *CNP-building-blocks.db - database on carbon, nitrogen and phosphorus content in raw and processed food.*
- input: (i) **merged_db_original.xlsx** (it requires evaluation of NA values and validation of building block concentration vs. total macronutrient content for every food item); (ii) **macronutrient_details.xlsx** (to import the concentration of molecules as oligosaccharides, fatty acids and amino acids in different food items; the file also includes a classification of the various building block molecules into three categories of macromolecules - see the column "Class" in the sheet "Element" where S stands for sugars, L for lipids and P for proteins)
- R scripts: (i) **manage_NA_function.R** (function that classifies NA values as either zeros or non-zero values; i.e. in this latter case the total content of the macromolecule is evenly assigned to all its building blocks - this is the case of amino acids with respect to total amount of proteins); (ii) **check_totals_function.R** (function that compares the total amount of each macromolecule with the sum of the corresponding constitutive molecules - e.g. sum of amino acids vs. total protein concentration; if the difference exceeds by 1% in absolute value the total amount of the macronutrient then such deviation is redistributed among all partial components in proportion to their relative importance compared to the total sum of all simple molecules of the same type - i.e. either by adding or removing quantities from the concentration of each building block molecule); (iii) **manage_NA---correct_total.R** (script that employs the two functions previously described for dealing with NA values and inconsistencies between total macromolecule contents and concentrations of corresponding building block molecules; the script serves to obtain the first complete data output on food composition and also produces a data quality file for technical validation)
- output: (i) **food_nutrient_composition_db.xlsx** (the file generated at this step is the first part of the database, which accounts for nutrient composition of food items; the concentrations of all molecules in the food nutrient composition database are expressed as grams per 100 grams of edible portion, fresh weight); (ii) **data_quality.xlsx** (file storing details on changes made/records of modifications - if any - to obtain concentration values reported in the database on food nutrient composition) - possible codes displayed by the file: SD (source data), meaning that the value was available in the original sources; ND (not defined), indicating that the value was not reported in the original sources and was set to zero during the execution of the scripts; MVR (missing value recalculated), which means that the value was declared as NA in the original dataset but the execution of the scripts quantified the concentration of the component by evenly distributing among all building block molecules (e.g. amino acids) the total amount of the corresponding macronutrient category (e.g. proteins); AVA+ (available value adjusted in positive), which explains that the value available in the original sources was increased (proportionally to the relative importance of the simple molecule with respect to the sum of all other simple molecules of the same type) to match the sum of the simple molecules with the total amount of the corresponding macronutrient category; AVA- (available value adjusted in negative), with the value available in the original sources that was proportionally decreased to match the sum of the simple molecules with the total amount of the corresponding macronutrient category (i.e. the procedure was analogous to what is described in AVA+, except for the fact that quantities were subtracted instead of added to the original values)

### step 3
conversion of nutrient data stored in food_nutrient_composition_db.xlsx into elemental contents (i.e. the output file includes details on carbon, nitrogen and phosphorus concentrations in 954 food items)
- input: (i) **food_nutrient_composition_db.xlsx** (output of the previous step, it includes details on macromolecules and their constitutive building blocks for 954 food items; NA values and inconsistencies - i.e. lack of coherence between total contents of macromolecules and sums of the simple molecules belonging to each macromolecule category - were removed by executing the scripts in step 2); (ii) **macronutrient_details.xlsx** (in particular, to import details on carbon and nitrogen concentration in building block molecules of sugars, lipids and proteins - see columns "Component", "C" and "N" in the sheet "Element"); (iii) **Mariotti.xlsx** (it includes protein/nitrogen ratios specific for various categories of food as reported in Mariotti et al. 2008, *Converting nitrogen into protein – beyond 6.25 and Jones’ factors*)
- R script: the commands in the file **nutrients_to_CNP_db.R** allow creating the comprehensive database on carbon, nitrogen and phosphorus contents in 954 food items; the contents of nitrogen are in three columns since different methods were used: (i) calculation of nitrogen in amino acids based on the chemical formula of the molecules; (ii) application of the constant conversion factor of 6.25 (i.e. nitrogen content is calculated from protein concentration by assuming a constant protein/nitrogen ratio equal to 6.25); (iii) nitrogen concentration obtained by dividing the protein content with various conversion factors that are specific for the different food categories (such values are stored in the file Mariotti.xlsx, sheet "Mariotti"; the correspondence between food categories and single food items is in the same file, sheet "classified_Mariotti")
- output: **food_elemental_composition_db.xlsx**, which represents the second part of the database and summarizes in five columns (one for carbon, one for phosphorus and three for nitrogen) the elemental composition of 954 food items (all contents are expressed as grams per 100 grams of edible portion, fresh weight)

### step 4
calculation of elemental composition (carbon, nitrogen and phosphorus) in 13 large food categories (e.g. vegetables, fruits, grains, seeds, meat and fish/seafood)
- input: (i) **food_elemental_composition_db.xlsx** (file including elemental composition of an extremely detailed list of food items; it was created in the previous step 3); (ii) **food_data_background.xlsx**, which provides a classification of 304 single food items into one of the 13 large food categories (sheet "Codes")
- R script: the file **food_categories_average.R** is used to extract the subset of food items that needs to be considered for calculating the average carbon, nitrogen (the analysis refers to nitrogen concentration in amino acids and is calculated from the chemical formulas of the molecules) and phosphorus content in 13 large food categories; correspondence between single food items and the 13 categories is obtained through codes stored in the file food_data_background.xlsx
- output: **food_category_CNP_db.xlsx**, which reports average values of carbon, nitrogen (from amino acids) and phosphorus in 13 large food categories (all contents are expressed as grams per 100 grams of edible portion, fresh weight)
